<!DOCTYPE html>
<html lang="pt-BR" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UOL Televis√£o - Display de Not√≠cias</title>
    
    <!-- Tailwind CSS Play CDN (Oficial) -->
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    
    <!-- Google Fonts - Poppins -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;700;900&display=swap" rel="stylesheet">
    
    <style type="text/tailwindcss">
        @theme {
            --font-family-poppins: 'Poppins', sans-serif;
            --color-cpf-red-500: #7F0D14;
            --color-cpf-red-700: rgba(127, 13, 20, 0.7);
            --color-cpf-red-900: rgba(127, 13, 20, 0.9);
        }
        
        .bg-transition {
            transition: background-image 0.5s ease-in-out;
        }
        
        .cpf-red-bg-700 {
            background-color: rgba(127, 13, 20, 0.7);
        }
        
        .cpf-red-bg-900 {
            background-color: rgba(127, 13, 20, 0.9);
        }
    </style>
</head>
<body class="h-full m-0 p-0 overflow-hidden bg-gray-700 font-poppins flex flex-col justify-between">
    <!-- TOPO DIREITO: APENAS A IDENTIDADE DA PLATAFORMA (CPFtv) -->
    <div class="absolute top-5 right-5 cpf-red-bg-700 px-4 py-2 rounded z-30">
        <div class="text-white text-2xl font-black">CPF TV</div> 
    </div>
 
    <div id="fullscreen-bg" class="flex-1 bg-cover bg-center relative bg-gray-800 bg-transition min-h-0"></div>
    
    <!-- IMEDIATAMENTE ACIMA DO RODAP√â -->
    <div class="w-full bg-black bg-opacity-60 px-8 py-3 flex justify-between items-center z-10">
        <!-- Informa√ß√µes do Clima - Lado Esquerdo -->
        <div class="flex items-center gap-4">
            <span class="text-white text-base font-bold" id="weatherInfo">Carregando clima...</span>
            <span class="text-white text-sm opacity-75" id="weatherTime"></span>
        </div>
        
        <!-- Informa√ß√µes da Fonte - Lado Direito -->
        <div class="flex items-center gap-3">
            <span class="text-white text-base font-bold" id="sourceText"></span>
            <img src="https://rss.kxmidia.com.br/news/imgs/uollogo.png" 
                 alt="Logo UOL" 
                 class="max-h-9"
                 onerror="this.style.display='none';"
            >
        </div>
    </div>

    <div id="footer" class="cpf-red-bg-900 text-white text-left px-8 py-5 text-2xl font-bold leading-tight z-20">Carregando not√≠cias...</div>

    <script>
        const APIS = [
            {
                name: "UOL",
                url: "https://rss.suatv.com.br/Uol/Convert/Economia.php",
                logo: "http://rss.suatv.com.br/Uol/img/logo1.png"
            },
            {
                name: "Veja",
                url: "https://rss.suatv.com.br/Veja/Convert/Noticias.php",
                logo: "http://rss.suatv.com.br/Veja/img/logo1.png"
            },
            {
                name: "BBC Brasil",
                url: "https://rss.suatv.com.br/BBC/Convert/Brasil.php",
                logo: "http://rss.suatv.com.br/BBC/img/logo1.png"
            },
            
        ];
        
        const UPDATE_INTERVAL_MS = 25 * 1000; // 15 segundos
        const FETCH_INTERVAL_MS = 10 * 60 * 1000; // 10 minutos
        
        // Configura√ß√µes da API de clima
        const API_KEY = '89c0297e8329dad813ff5a905d14544e'; // Chave OpenWeather
        const CITY = 'Macei√≥,BR';
        
        let currentItemIndex = 0; // √çndice do item atual
        let newsItems = []; // Array para armazenar os itens do RSS (todas as fontes)
        let currentSourceIndex = 0; // √çndice da fonte atual

        /**
         * Busca e processa not√≠cias de todas as fontes RSS
         */
        async function fetchNews() {
            try {
                console.log('Come√ßando a buscar not√≠cias de todas as fontes...');
                
                // Array para guardar todas as not√≠cias de todas as fontes
                const todasAsNoticias = [];
                
                // Percorre cada fonte de not√≠cias configurada
                for (const fonte of APIS) {
                    try {
                        console.log(`Buscando not√≠cias de: ${fonte.name}`);
                        
                        // Faz a requisi√ß√£o para a API da fonte
                        const response = await fetch(fonte.url);
                        if (!response.ok) {
                            throw new Error(`Erro HTTP ${response.status} - ${response.statusText}`);
                        }

                        // Converte resposta em texto (XML)
                        const arrayBuffer = await response.arrayBuffer();
                        const decoder = new TextDecoder('utf-8');
                        const xmlText = decoder.decode(arrayBuffer);
                        
                        // Transforma XML em documento que podemos navegar
                        const parser = new DOMParser();
                        const xmlDoc = parser.parseFromString(xmlText, 'application/xml');
                        const itemsXML = xmlDoc.querySelectorAll('item');

                        // Se encontrou not√≠cias nesta fonte, processa cada uma
                        if (itemsXML.length > 0) {
                            for (const item of itemsXML) {
                                const titulo = item.querySelector('title')?.textContent?.trim() || '';
                                const descricao = item.querySelector('description')?.textContent?.trim() || '';
                                const imagem = item.querySelector('linkfoto')?.textContent?.trim() || '';
                                const data = item.querySelector('date')?.textContent?.trim() || '';
                                
                                // Cria o objeto da not√≠cia com info da fonte
                                const noticia = {
                                    title: titulo,
                                    description: descricao,
                                    image: imagem,
                                    date: data,
                                    sourceName: fonte.name,
                                    sourceLogo: fonte.logo,
                                    sourceUrl: fonte.url
                                };
                                
                                todasAsNoticias.push(noticia);
                            }
                            
                            console.log(`‚úÖ ${itemsXML.length} not√≠cias carregadas de ${fonte.name}`);
                        } else {
                            console.warn(`‚ö†Ô∏è Nenhuma not√≠cia encontrada em ${fonte.name}`);
                        }
                        
                    } catch (erro) {
                        console.error(`‚ùå Erro ao buscar ${fonte.name}:`, erro.message);
                        // Continua tentando as outras fontes mesmo se uma falhar
                    }
                }
                
                // Se conseguiu alguma not√≠cia, atualiza o sistema
                if (todasAsNoticias.length > 0) {
                    newsItems = todasAsNoticias;
                    currentItemIndex = 0; // Come√ßa da primeira not√≠cia
                    
                    console.log(`üéâ Total: ${newsItems.length} not√≠cias carregadas de ${APIS.length} fontes`);
                    
                    // Mostra a primeira not√≠cia imediatamente
                    showCurrentNews();
                } else {
                    // Nenhuma fonte funcionou
                    const footerDiv = document.getElementById('footer');
                    if (footerDiv) {
                        footerDiv.textContent = 'Nenhuma not√≠cia dispon√≠vel no momento...';
                    }
                    console.warn('‚ùå Nenhuma not√≠cia foi encontrada em nenhuma fonte');
                }

            } catch (erro) {
                console.error('‚ùå Erro geral ao buscar not√≠cias:', erro);
                const footerDiv = document.getElementById('footer');
                if (footerDiv) {
                    footerDiv.textContent = `Erro: ${erro.message}. Tentando novamente...`;
                }
            }
        }

        /**
         * Busca informa√ß√µes do clima atual em Macei√≥
         */
        async function fetchWeather() {
            try {
                console.log('Buscando informa√ß√µes do clima...');
                
                // Faz requisi√ß√£o para API do OpenWeatherMap
                const response = await fetch(
                    `https://api.openweathermap.org/data/2.5/weather?q=${CITY}&appid=${API_KEY}&units=metric&lang=pt_br`
                );
                
                if (!response.ok) {
                    throw new Error(`Erro na API de clima: ${response.status}`);
                }
                
                const climaData = await response.json();
                
                // Pega os elementos da p√°gina onde vamos mostrar o clima
                const weatherInfoSpan = document.getElementById('weatherInfo');
                const weatherTimeSpan = document.getElementById('weatherTime');
                
                if (weatherInfoSpan && weatherTimeSpan) {
                    // Extrai informa√ß√µes do clima
                    const temperatura = Math.round(climaData.main.temp);
                    const descricao = climaData.weather[0].description;
                    const cidade = climaData.name;
                    const sensacao = Math.round(climaData.main.feels_like);
                    const umidade = climaData.main.humidity;
                    
                    // Atualiza as informa√ß√µes na tela
                    weatherInfoSpan.textContent = `${cidade}: ${temperatura}¬∞C, ${descricao}`;
                    weatherTimeSpan.textContent = `Sensa√ß√£o ${sensacao}¬∞C ‚Ä¢ Umidade ${umidade}%`;
                    
                    console.log(`‚úÖ Clima atualizado: ${temperatura}¬∞C em ${cidade}`);
                } else {
                    console.error('Elementos do clima n√£o encontrados na p√°gina');
                }
                
            } catch (erro) {
                console.error('‚ùå Erro ao buscar clima:', erro.message);
                
                // Mostra erro na tela se algo deu errado
                const weatherInfoSpan = document.getElementById('weatherInfo');
                const weatherTimeSpan = document.getElementById('weatherTime');
                
                if (weatherInfoSpan) {
                    weatherInfoSpan.textContent = 'Erro ao carregar clima';
                }
                if (weatherTimeSpan) {
                    weatherTimeSpan.textContent = '';
                }
            }
        }

        /**
         * Exibe uma not√≠cia na tela - fun√ß√£o principal de exibi√ß√£o
         */
        function showCurrentNews() {
            if (newsItems.length === 0) {
                console.warn('Nenhuma not√≠cia dispon√≠vel');
                return;
            }

            // Pega a not√≠cia atual do array
            const currentNews = newsItems[currentItemIndex];
            if (!currentNews) {
                console.error('Not√≠cia atual n√£o encontrada');
                return;
            }

            // Busca os elementos da p√°gina que vamos atualizar
            const backgroundDiv = document.getElementById('fullscreen-bg');
            const footerDiv = document.getElementById('footer');
            const sourceTextSpan = document.getElementById('sourceText');
            const sourceImg = document.querySelector('.w-full.bg-black img');

            // Verifica se encontrou todos os elementos
            if (!backgroundDiv || !footerDiv || !sourceTextSpan || !sourceImg) {
                console.error('Algum elemento da p√°gina n√£o foi encontrado');
                return;
            }

            // 1. Atualiza o t√≠tulo da not√≠cia no rodap√©
            const newsTitle = currentNews.description || currentNews.title || 'T√≠tulo indispon√≠vel';
            footerDiv.textContent = newsTitle;

            // 2. Atualiza a imagem de fundo
            if (currentNews.image) {
                backgroundDiv.style.backgroundImage = `url('${currentNews.image}')`;
            } else {
                console.warn('Imagem n√£o encontrada para esta not√≠cia');
            }

            // 3. Atualiza o texto da fonte
            const sourceName = currentNews.sourceName || 'Fonte desconhecida';
            // sourceTextSpan.textContent = `Fonte: ${sourceName}`;
            sourceTextSpan.textContent = `Fonte: `;

            // 4. Atualiza o logo da fonte
            if (currentNews.sourceLogo) {
                sourceImg.src = currentNews.sourceLogo;
                sourceImg.style.display = 'block';
            } else {
                sourceImg.style.display = 'none';
            }

            // 5. Log para acompanhamento
            console.log(`Mostrando not√≠cia ${currentItemIndex + 1}/${newsItems.length} de ${sourceName}: ${newsTitle}`);

            // 6. Avan√ßa para a pr√≥xima not√≠cia (volta para primeira quando chegar no final)
            currentItemIndex++;
            if (currentItemIndex >= newsItems.length) {
                currentItemIndex = 0; // Volta para primeira not√≠cia
            }
        }

        /**
         * Inicia a rota√ß√£o autom√°tica das not√≠cias
         */
        function startItemRotation() {
            setInterval(() => {
                showCurrentNews(); // Muda para pr√≥xima not√≠cia a cada 5 segundos
            }, UPDATE_INTERVAL_MS);
        }

        // === INICIALIZA√á√ÉO DO SISTEMA ===
        
        // Busca as not√≠cias pela primeira vez
        fetchNews();
        
        // Busca informa√ß√µes do clima pela primeira vez
        fetchWeather();
        
        // Inicia a rota√ß√£o autom√°tica a cada 25 segundos  
        startItemRotation();
        
        // Recarrega todas as not√≠cias a cada 10 minutos
        setInterval(fetchNews, FETCH_INTERVAL_MS);
        
        // Atualiza o clima a cada 30 minutos (clima n√£o muda tanto)
        setInterval(fetchWeather, 30 * 60 * 1000); 
    </script>
</body>
</html>
